# IP (L3)
IP(Internet Protocol) 은
네트워크 상에서 **데이터를 목적지까지 전달하기 위한 규칙(프로토콜)** 이다.
즉 데이터가 어디로 가야 하는지를 결정하는 주소·경로 담당자.

L3 IP Packet <------- 중요하다

### IP의 주요 역할
| 역할                               | 설명                       |
| -------------------------------- | ------------------------ |
| **주소 지정(Addressing)**            | 각 장치에 고유한 IP 주소를 부여      |
| **패킷 전달(Routing)**               | 데이터를 목적지까지 여러 라우터를 통해 전달 |
| **단편화(Fragmentation)**           | 패킷이 너무 클 경우 쪼개서 전송 MTU크기의 차이로 발생한다.      |
| **최선형 전달(Best-Effort Delivery)** | 신뢰성 보장 없음 (손실 가능성 존재)    |

>IP 자체는 “신뢰성 없는 전달”을 전제로 하고, 신뢰성은 상위 계층(TCP)이 보장한다.

### IPv4 구조
``` 
예시: 192.168.0.1

Subnet Mask: 255.255.255.0
→ Network: 192.168.0 / Host: 1
```
| 부분             | 의미              | 예시
| -------------- | --------------- | ---|
| **Network ID** | 네트## ARP와 ICMP (보조 프로토콜)워크 구역 식별      | 192.168.0
| **Host ID**    | 해당 네트워크 내 장치 식별 | 1

네트워크를 나누는 기준은 서브넷 마스크(Subnet Mask)로 결정된다.

### CIDR(Classless Inter-Domain Routing)
IP 주소와 서브넷 마스크를 함께 표기하는 방식이다.  
예를들어 192.168.0.1/24 이렇게 되어있다면
ID/24 로 표기해서 왼쪽부터 24bit를 네트워크ID라고 한다고 표기하는 방식이다  
여기서 /24는 서브넷 마스크에서 1로 설정된 비트 개수를 의미한다.  
즉 /24 = 255.255.255.0 = FF FF FF 0


### IPv6 구조
IPv6는 IPv4의 주소 고갈 문제를 해결하기 위해 만들어졌습니다.
| 항목        | IPv4        | IPv6                      |
| --------- | ----------- | ------------------------- |
| 주소 길이     | 32비트        | 128비트                     |
| 표현 방식     | 10진수 4개     | 16진수 8개                   |
| 예시        | 192.168.0.1 | 2001:0db8::ff00:0042:8329 |
| NAT 필요성   | 있음          | 거의 없음                     |
| 보안(IPSec) | 선택적         | 기본 내장                     |

### ARP와 ICMP (보조 프로토콜)
#### ARP (Address Resolution Protocol)
- IP주소 → MAC주소로 변환
- 같은 네트워크 내에서 통신 시 사용
- IP주소를 이용해 상대방의 MAC주소를 알아오는 프로토콜

우선 처음에 Broadcast로 ARP Request가 보내진다. (해당 Gateway 주소가 존재하는지)
그 뒤에 패킷을 보내는데 패킷을 보낼때 한번에 목적지로 보내지 않는다. 
IP주소는 해당 목적지 이지만 도착 MAC 주소는 Gateway의 MAC주소를 사용한다.
ARP Request로 얻은 Gateway의 MAC주소는 캐싱이 가능해서 한번 얻으면 저장해놓았다 사용한다

#### ICMP (Internet Control Message Protocol)
- IP 패킷의 오류나 상태를 알려주는 프로토콜
- ping, traceroute 명령에서 사용됨
- IP제어와 메시지 기능을 담당

### 라우팅(Routing)
**라우터(Router)** 는 패킷이 목적지에 도달할 수 있도록 최적의 경로를 선택한다.
- 라우팅 테이블 기반으로 다음 홉(next hop) 결정
- 각 홉마다 패킷 헤더의 TTL(Time To Live)[^1] 1씩 감소  
    → TTL이 0이 되면 폐기 + ICMP 에러 응답

### NAT (Network Address Translation)
**사설 IP ↔ 공인 IP 변환 기술**
- 하나의 공인 IP로 여러 장치가 인터넷에 접속 가능
- 공유기(router)가 NAT 수행  

| 유형                                 | 설명                      |
| ---------------------------------- | ----------------------- |
| **Static NAT**                     | IP 1:1 매핑               |
| **Dynamic NAT**                    | IP 풀에서 임시 할당            |
| **PAT (Port Address Translation)** | 하나의 공인 IP에 여러 포트로 다중 매핑 |

### IP 프래그먼테이션(Fragmentation)
- MTU(Maximum Transmission Unit)[^2] 보다 큰 패킷은 쪼개서 보냄
- 수신 측에서 재조립
- TCP는 이를 피하기 위해 Path MTU Discovery 사용

[^1]: TTL은 TTL에 정해진 수만큼 라우터를 거치다가 TTL이 점점 줄어 0이 되면 패킷을 폐기한다.
[^2]: “한 번에 전송할 수 있는 패킷의 최대 크기(Byte 단위)”를 의미한다.